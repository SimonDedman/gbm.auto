# Remove expvars now they've been used for wide-long-wide transform
disl3 <- disl3[13:43]
dislWide <- dislWide[13:30]
# subset resvars w >10 positive values
posSamples <- colSums(disl3bin)
posSamplesSub <- posSamples > 10
disl3sub <- disl3[posSamplesSub]
posSamples <- colSums(dislWidebin)
posSamplesSub <- posSamples > 10
dislWidesub <- dislWide[posSamplesSub]
#jump to here####
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/")
disl3 <- read.csv("disl3.csv")
# THIS IS POSSIBLY BROKEN
# add M & F manually from disl3sub. Pool in excel
write.csv(disl3, file = "disl3.csv")
# pooled in excel
disl3pool <- read.csv("disl3pool.csv")
posSamples <- colSums(disl3pool)
posSamplesSub <- posSamples > 10
dislWidesub <- disl3pool[posSamplesSub]
# 1 more expvar (finetooth), rows align with original rows in disl3 therefore with expvars.
# column order is original not alphabetical
# remove temp & unneeded objects
rm(list = c("disl", "disl_tmp", "dislWide_tmp", "missF", "missFimp", "sundata", "sunriseset", "char.ids", "datevec", "daylength", "posSamples", "posSamplesSub"))
View(disl3)
View(disl2)
colnames(disl2)
#ranges
for(i in colnames(disl2)){
range(disl2[i])
}
#ranges
for(i in colnames(disl2)){
range(disl2[get(i)])
}
#ranges
for(i in colnames(disl2)){
range(disl2[,i])
}
disl2[,Year]
disl2[,"Year"]
disl2[Year]
#ranges
for(i in colnames(disl2)){
range(disl2[,as.character(i)])
}
disl2[as.chaaracter(Year)]
disl2[as.character(Year)]
}
#ranges
for(i in 1:length(colnames(disl2))){
range(disl2[,i])
}
#ranges
for(i in 1:c(1,4:10,12)){
range(disl2[,i])
}
c(1,4:10,12)
#ranges
for(i in 1 : (c(1,4:10,12))){
range(disl2[,i])
}
range(disl2[,1])
#ranges
for(i in 1 : (c(1,4:10,12))){
print(i)
#range(disl2[,i])
}
(c(1,4:10,12))
for(i in 1:10){
print(i)
}
#ranges
for(i in c(1,4:10,12)){
range(disl2[,i])
}
#ranges
for(i in c(1,4:10,12)){print(range(disl2[,i]))}
#ranges
for(i in c(1,4:10,12)){
print(colnames(disl2)[i])
print(range(disl2[,i]))
}
# John & Simon's data formatting script 26.1.2017
#Code Prep----
#SetWD load install library====
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/")
disl <- read.csv("disl.csv")
disl2["Station.ID"]
110852.4248*0.083
110852.4248/25
colnames(Report)[1]
colnames(Report)[2]
paste0("loop", i)
debugSource('C:/Users/simon/Dropbox/Galway/Analysis/R/gbm.auto/R/gbm.loop.R')
source('C:/Users/simon/Dropbox/Galway/Analysis/R/gbm.auto/R/gbm.loop.R')
library(devtools)
install_github("SimonDedman/gbm.auto") # update gbm.auto to latest
library(gbm.auto)
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT")
sharks <- read.csv("SharksIncExtra&HYCOM&QGis.csv")
#, header = TRUE, colClasses = c("Start.Set.Depth" = "numeric"))
sharks$Surface.Temperature <- as.numeric(as.character(sharks$Surface.Temperature))
sharks$Bottom.Temperature <- as.numeric(as.character(sharks$Bottom.Temperature))
sharks$Surface.DO <- as.numeric(as.character(sharks$Surface.DO))
sharks$Bottom.DO <- as.numeric(as.character(sharks$Bottom.DO))
sharks$Start.Set.Depth <- as.numeric(as.character(sharks$Start.Set.Depth))
tmp <- as.POSIXlt(as.character(sharks$Daylength), format = "%H:%M:%S")
sharks$Daylength <- tmp$hour*60 + tmp$min + tmp$sec/60
expvars <- c("Daylength", #need to calculate for grids DONE
"Surface.Temperature", #use these or NOAA ones? These. Histograms are similar and better to use the real data.
"Bottom.Temperature",
# hist(sharks$Surface.Temperature)
# hist(sharks$TempSurf)
"Bottom.DO",
"Longitude",
"Start.Set.Depth",
"SubGrainMM",
"DST_km",
"SalSurf",
"SalBot",
#"TempSurf", #redundant
#"TempBot",
"USurf",
"UBot",
"VSurf",
"VBot",
"WSurf",
"WBot",
"SSH")
rm("tmp")
"POSdatetimeZ",
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/SpatialData")
gridswinter <- read.csv("gridswinter2.csv") #read in grids files
gridsspring <- read.csv("gridsspring2.csv")
gridssummer <- read.csv("gridssummer2.csv")
gridsautumn <- read.csv("gridsautumn2.csv")
# are grids' DO values surface or bottom? Bottom.
colnames(gridswinter)[46] <- "Bottom.DO" #change temp colname to match sharks
library("shapefiles")
#mobilebay <- read.shapefile("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn/GSHHS_shp/h/GSHHS_h_L1")
mobilebay <- read.shapefile("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn/CroppedMap/Crop_Map")
#gmbauto runs####
# expvars %in% colnames(gridswinter) #precheck expvars in grids
# remember which resvars & gbm run types I'm doing
#singlesex, bin+gaus else bin, 4 seasons.
resvars <- colnames(sharks)[17:62]
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
resvars[14]
for (d in resvars) {
print(d)
}
resvars
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
sharks32 <- c(1,2,5,6,7,8,12,13,21,22,23,24,31,32,33,34,35,39,41,42,43,44,45,46)
for (j in sharks32) {
print(colnames(sharks[j]))
gbm.bfcheck(samples = sharks,
resvar = j)
}
colnames(sharks)
sharks32cols <- sharks32 + 16
for (j in sharks32cols) {
print(colnames(sharks[j]))
gbm.bfcheck(samples = sharks,
resvar = j)
}
bflist <- as.list(
for (j in sharks32cols) {
print(colnames(sharks[j]))
gbm.bfcheck(samples = sharks,
resvar = j)
}
)
for (j in 17:62) {
print(colnames(sharks[j]))
gbm.bfcheck(samples = sharks,
resvar = j)
}
sharks32bf <- c(1,2,5,6,7,8,12,13,22,32,33,35,39,41,42,43,44,45,46)
sharks32bfcols <- sharks32 + 16 #resvars start at 17
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
colnames(sharks)[sharks32bfcols]
for (i in sharks32bfcols) {
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.01,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT")
sharks <- read.csv("SharksIncExtra&HYCOM&QGis.csv")
#, header = TRUE, colClasses = c("Start.Set.Depth" = "numeric"))
sharks$Surface.Temperature <- as.numeric(as.character(sharks$Surface.Temperature))
sharks$Bottom.Temperature <- as.numeric(as.character(sharks$Bottom.Temperature))
sharks$Surface.DO <- as.numeric(as.character(sharks$Surface.DO))
sharks$Bottom.DO <- as.numeric(as.character(sharks$Bottom.DO))
sharks$Start.Set.Depth <- as.numeric(as.character(sharks$Start.Set.Depth))
tmp <- as.POSIXlt(as.character(sharks$Daylength), format = "%H:%M:%S")
sharks$Daylength <- tmp$hour*60 + tmp$min + tmp$sec/60
sharks <- read.csv("SharksIncExtra&HYCOM&QGis.csv")
View(sharks)
sharks$Daylength
tmp <- as.POSIXlt(as.character(sharks$Daylength), format = "%H:%M:%S")
rm("tmp")
tmp <- as.POSIXlt(as.character(sharks$Daylength), format = "%H:%M:%S")
as.POSIXlt(as.character(sharks$Daylength), format = "%H:%M:%S")
sharks$Daylength
as.character(sharks$Daylength)
tmp <- as.POSIXct(as.character(sharks$Daylength), format = "%H:%M:%S")
as.POSIXlt("778.25", format = "%H:%M:%S")
as.POSIXlt("778.25", format = "%H:%M:%S", tz = "")
as.POSIXlt("778.25", format = "%H:%M:%S", tz = "GMT")
sharks <- read.csv("SharksIncExtra&HYCOM&QGis.csv")
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
for (i in sharks32bfcols) {
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.01,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
source('~/Dropbox/Galway/Analysis/R/gbm.auto/R/gbm.auto.R')
for (i in sharks32bfcols) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.01,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
source('~/Dropbox/Galway/Analysis/R/gbm.auto/R/gbm.utils.R')
for (i in sharks32bfcols) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.01,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
sharks32bfcols
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.008,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
gbm.auto(expvar = expvars,
resvar = 22,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.005,
BF = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.008,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
gbm.auto(expvar = expvars,
resvar = 28,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.005,
BF = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
gbm.auto(expvar = expvars,
resvar = 28,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.001,
BF = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.008,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
gbm.auto(expvar = expvars,
resvar = 29,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.001,
BF = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
gbm.auto(expvar = expvars,
resvar = 29,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
BF = 0.65,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
# resvars[14] #check resvar name
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.008,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
# resvars[14] #check resvar name
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
sharks45 <- c(1,2,5,6,7,8,12,13,22,23,32,33,34,39,41,42,43,44,45,46)
sharks45cols <- sharks45 + 16 #resvars start at 17
sharks45cols <- sharks45 + 16 #resvars start at 17
sharks45cols
# resvars[14] #check resvar name
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,29,37,38,39,40,47,48,49,50,51,55,57,58,59,60,61,62) { #MAIN SET OF 19 BEST
for (i in c(38,39,48,49,50,55,57,58,59,60,61,62)) { #MAIN SET OF 19 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
sharks45cols
colnames(sharks)[38]
sharks50 <- c(1,2,5,6,7,8,12,13,23,32,33,34,39,41,42,43,44,45,46)
sharks50cols <- sharks50 + 16 #resvars start at 17
#for (i in c(17,18,21,22,23,24,28,39,48,49,50,55,57,58,59,60,61,62) { #MAIN SET OF 20 BEST
for (i in c(39,48,49,50,55,57,58,59,60,61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
colnames(sharks)[39]
sharks50 <- c(1,2,5,6,7,8,12,13,23,32,33,34,41,42,43,44,45,46)
sharks50cols <- sharks50 + 16 #resvars start at 17
#for (i in c(17,18,21,22,23,24,28,48,49,50,55,57,58,59,60,61,62) { #MAIN SET OF 20 BEST
for (i in c(48,49,50,55,57,58,59,60,61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
sharks50cols
sharks50 - 16
sharks50
sharks50 <- c(1,2,5,6,7,8,12,13,23,32,33,34,41,42,43,44,45)
sharks50cols <- sharks50 + 16 #resvars start at 17
sharks50
sharks50 <- c(1,2,5,6,7,8,12,13,23,32,33,35,41,42,43,44,45)
sharks50cols <- sharks50 + 16 #resvars start at 17
35+16
#for (i in c(17,18,21,22,23,24,28,48,49,51,55,57,58,59,60,61,62) { #MAIN SET OF 20 BEST
for (i in c(51,55,57,58,59,60,61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
#for (i in c(17,18,21,22,23,24,28,48,49,51,55,57,58,59,60,61,62) { #MAIN SET OF 20 BEST
for (i in c(59,60,61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.6,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
for (i in c(61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.7,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
# resvars[14] #check resvar name
# colnames(sharks)[39]
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/autumn")
#for (i in c(17,18,21,22,23,24,28,48,49,51,55,57,58,59,60,61,62) { #MAIN SET OF 20 BEST
for (i in c(61,62)) { #MAIN SET OF 20 BEST
gbm.auto(expvar = expvars,
resvar = i,
samples = sharks,
grids = gridsautumn,
shape = mobilebay,
lr = 0.0005,
bf = 0.8,
gaus = TRUE,
savegbm = FALSE,
BnW = FALSE,
simp = TRUE)
}
setwd("/home/simon/Dropbox/PostDoc Work/Drymon Froeschke transect BRT/Gbm_auto_runs/PredictRuns/spring")
